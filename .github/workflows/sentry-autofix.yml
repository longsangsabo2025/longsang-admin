# ============================================================================
# ðŸš¨ SENTRY â†’ MEGA AUTO-FIX PIPELINE - Elon Musk Edition
# ============================================================================
# ðŸŽ¯ Ultimate Error Detection & Auto-Fix System
# Flow: Sentry Error â†’ AI Analysis â†’ Pattern Match â†’ Auto-Fix â†’ PR â†’ Deploy
# ============================================================================

name: ðŸ› Sentry Auto-Fix Pipeline

on:
  # Webhook from Sentry (configured in Sentry â†’ Settings â†’ Integrations â†’ Webhooks)
  repository_dispatch:
    types: [sentry-error]
  
  # Manual trigger for testing
  workflow_dispatch:
    inputs:
      error_title:
        description: 'Error title/type'
        required: true
        default: 'TypeError: Cannot read property'
      error_message:
        description: 'Error message'
        required: true
        default: 'Cannot read property of undefined'
      file_path:
        description: 'File path where error occurred'
        required: false
        default: 'src/components/Example.tsx'
      line_number:
        description: 'Line number'
        required: false
        default: '1'
      auto_merge:
        description: 'Auto-merge if tests pass'
        required: false
        default: 'false'
        type: boolean

permissions:
  contents: write
  pull-requests: write
  issues: write

env:
  # Error patterns that are safe to auto-fix
  SAFE_FIX_PATTERNS: 'TypeError|ReferenceError|undefined|null|is not a function'
  # Patterns that need manual review
  MANUAL_REVIEW_PATTERNS: 'SecurityError|OutOfMemory|StackOverflow'

jobs:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 1: Deep Error Analysis
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  analyze-error:
    name: ðŸ” Deep Error Analysis
    runs-on: ubuntu-latest
    outputs:
      should_fix: ${{ steps.analyze.outputs.should_fix }}
      fix_type: ${{ steps.analyze.outputs.fix_type }}
      fix_strategy: ${{ steps.analyze.outputs.fix_strategy }}
      confidence: ${{ steps.analyze.outputs.confidence }}
      error_details: ${{ steps.analyze.outputs.error_details }}
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ” Deep Error Analysis
        id: analyze
        run: |
          # Get error details from webhook or manual input
          if [ "${{ github.event_name }}" == "repository_dispatch" ]; then
            ERROR_TITLE="${{ github.event.client_payload.error_title }}"
            ERROR_MESSAGE="${{ github.event.client_payload.error_message }}"
            FILE_PATH="${{ github.event.client_payload.file_path }}"
            LINE_NUMBER="${{ github.event.client_payload.line_number }}"
            STACK_TRACE="${{ github.event.client_payload.stack_trace }}"
          else
            ERROR_TITLE="${{ github.event.inputs.error_title }}"
            ERROR_MESSAGE="${{ github.event.inputs.error_message }}"
            FILE_PATH="${{ github.event.inputs.file_path }}"
            LINE_NUMBER="${{ github.event.inputs.line_number }}"
            STACK_TRACE=""
          fi
          
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ðŸ” SENTRY ERROR ANALYSIS"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "Error: $ERROR_TITLE"
          echo "Message: $ERROR_MESSAGE"
          echo "File: $FILE_PATH"
          echo "Line: $LINE_NUMBER"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          
          # Initialize variables
          FIX_TYPE="manual"
          FIX_STRATEGY=""
          SHOULD_FIX="false"
          CONFIDENCE="low"
          
          # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          # PATTERN MATCHING - Determine fix type and strategy
          # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          
          # 1. Null/Undefined errors - Add optional chaining
          if [[ "$ERROR_TITLE" == *"TypeError"* ]] && [[ "$ERROR_MESSAGE" == *"undefined"* || "$ERROR_MESSAGE" == *"null"* || "$ERROR_MESSAGE" == *"Cannot read"* ]]; then
            FIX_TYPE="null-safety"
            FIX_STRATEGY="Add optional chaining (?.) or nullish coalescing (??)"
            SHOULD_FIX="true"
            CONFIDENCE="high"
          
          # 2. Not a function errors - Add type guards
          elif [[ "$ERROR_MESSAGE" == *"is not a function"* ]]; then
            FIX_TYPE="type-guard"
            FIX_STRATEGY="Add typeof check before function call"
            SHOULD_FIX="true"
            CONFIDENCE="high"
          
          # 3. Reference errors - Check variable declarations
          elif [[ "$ERROR_TITLE" == *"ReferenceError"* ]]; then
            FIX_TYPE="reference-fix"
            FIX_STRATEGY="Check variable scope and declarations"
            SHOULD_FIX="true"
            CONFIDENCE="medium"
          
          # 4. Network/Fetch errors - Add retry logic
          elif [[ "$ERROR_MESSAGE" == *"Network"* ]] || [[ "$ERROR_MESSAGE" == *"fetch"* ]] || [[ "$ERROR_MESSAGE" == *"Failed to fetch"* ]]; then
            FIX_TYPE="network-resilience"
            FIX_STRATEGY="Add try-catch with retry logic"
            SHOULD_FIX="true"
            CONFIDENCE="medium"
          
          # 5. Promise rejection - Add error handling
          elif [[ "$ERROR_MESSAGE" == *"Unhandled"* ]] || [[ "$ERROR_MESSAGE" == *"rejection"* ]]; then
            FIX_TYPE="promise-handling"
            FIX_STRATEGY="Add .catch() or try-await-catch block"
            SHOULD_FIX="true"
            CONFIDENCE="medium"
          
          # 6. Import/Module errors
          elif [[ "$ERROR_MESSAGE" == *"Cannot find module"* ]] || [[ "$ERROR_MESSAGE" == *"import"* ]]; then
            FIX_TYPE="import-fix"
            FIX_STRATEGY="Check import paths and exports"
            SHOULD_FIX="true"
            CONFIDENCE="medium"
          
          # 7. Array/Object iteration errors
          elif [[ "$ERROR_MESSAGE" == *"forEach"* ]] || [[ "$ERROR_MESSAGE" == *"map"* ]] || [[ "$ERROR_MESSAGE" == *"filter"* ]]; then
            FIX_TYPE="array-safety"
            FIX_STRATEGY="Add array existence check before iteration"
            SHOULD_FIX="true"
            CONFIDENCE="high"
          
          # 8. React hook errors
          elif [[ "$ERROR_MESSAGE" == *"hook"* ]] || [[ "$ERROR_MESSAGE" == *"Hook"* ]]; then
            FIX_TYPE="react-hook"
            FIX_STRATEGY="Check hook rules and dependencies"
            SHOULD_FIX="true"
            CONFIDENCE="low"
          
          # 9. Syntax errors - Run ESLint fix
          elif [[ "$ERROR_TITLE" == *"SyntaxError"* ]]; then
            FIX_TYPE="syntax"
            FIX_STRATEGY="Run ESLint --fix and Prettier"
            SHOULD_FIX="true"
            CONFIDENCE="high"
          fi
          
          # Check if file exists
          if [ -n "$FILE_PATH" ] && [ -f "$FILE_PATH" ]; then
            echo "âœ… File exists: $FILE_PATH"
          else
            echo "âš ï¸ File not found: $FILE_PATH"
            CONFIDENCE="low"
          fi
          
          echo ""
          echo "ðŸ“Š ANALYSIS RESULT:"
          echo "  Fix Type: $FIX_TYPE"
          echo "  Strategy: $FIX_STRATEGY"
          echo "  Should Fix: $SHOULD_FIX"
          echo "  Confidence: $CONFIDENCE"
          
          # Output results
          echo "should_fix=$SHOULD_FIX" >> $GITHUB_OUTPUT
          echo "fix_type=$FIX_TYPE" >> $GITHUB_OUTPUT
          echo "fix_strategy=$FIX_STRATEGY" >> $GITHUB_OUTPUT
          echo "confidence=$CONFIDENCE" >> $GITHUB_OUTPUT
          echo "error_details={\"title\":\"$ERROR_TITLE\",\"message\":\"$ERROR_MESSAGE\",\"file\":\"$FILE_PATH\",\"line\":\"$LINE_NUMBER\"}" >> $GITHUB_OUTPUT

      - name: ðŸ“Š Analysis Summary
        run: |
          echo "## ðŸ” Sentry Error Analysis" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Property | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|----------|-------|" >> $GITHUB_STEP_SUMMARY
          echo "| Fix Type | \`${{ steps.analyze.outputs.fix_type }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| Strategy | ${{ steps.analyze.outputs.fix_strategy }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Confidence | **${{ steps.analyze.outputs.confidence }}** |" >> $GITHUB_STEP_SUMMARY
          echo "| Auto-Fix | ${{ steps.analyze.outputs.should_fix == 'true' && 'âœ… Yes' || 'âŒ No' }} |" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 2: Create Tracking Issue
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  create-fix-issue:
    name: ðŸ“ Create Tracking Issue
    runs-on: ubuntu-latest
    needs: analyze-error
    if: needs.analyze-error.outputs.should_fix == 'true'
    outputs:
      issue_number: ${{ steps.create-issue.outputs.issue_number }}
    
    steps:
      - name: ðŸ“ Create GitHub Issue
        id: create-issue
        uses: actions/github-script@v7
        with:
          script: |
            const errorDetails = JSON.parse('${{ needs.analyze-error.outputs.error_details }}');
            const fixType = '${{ needs.analyze-error.outputs.fix_type }}';
            const fixStrategy = '${{ needs.analyze-error.outputs.fix_strategy }}';
            const confidence = '${{ needs.analyze-error.outputs.confidence }}';
            
            const confidenceEmoji = {
              'high': 'ðŸŸ¢',
              'medium': 'ðŸŸ¡', 
              'low': 'ðŸ”´'
            };
            
            const issue = await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ðŸ› [Auto-Fix] ${errorDetails.title}`,
              body: `## ðŸš¨ Sentry Error Auto-Fix Request

### Error Details
| Field | Value |
|-------|-------|
| **Type** | \`${errorDetails.title}\` |
| **Message** | ${errorDetails.message} |
| **File** | \`${errorDetails.file}\` |
| **Line** | ${errorDetails.line} |

### ðŸ”§ Fix Strategy
**Type:** \`${fixType}\`

**Approach:** ${fixStrategy}

### ðŸ“Š Confidence Level
${confidenceEmoji[confidence]} **${confidence.toUpperCase()}**

### ðŸ¤– Auto-Fix Instructions
1. Checkout file: \`${errorDetails.file}\`
2. Navigate to line: ${errorDetails.line}
3. Apply fix type: \`${fixType}\`
4. Verify with tests
5. Create PR if successful

### Labels
- \`bug\` - This is a bug fix
- \`auto-fix\` - Automated fix attempt
- \`sentry\` - From Sentry monitoring
- \`confidence-${confidence}\` - Fix confidence level

---
*ðŸ¤– Auto-generated by Sentry Auto-Fix Pipeline*
*Workflow Run: [#${{ github.run_number }}](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})*
`,
              labels: ['bug', 'auto-fix', 'sentry', `confidence-${confidence}`]
            });
            
            core.setOutput('issue_number', issue.data.number);
            console.log(`âœ… Created issue #${issue.data.number}`);

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 3: Apply Auto-Fix
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  apply-fix:
    name: ðŸ”§ Apply Auto-Fix
    runs-on: ubuntu-latest
    needs: [analyze-error, create-fix-issue]
    if: needs.analyze-error.outputs.should_fix == 'true'
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ”§ Create fix branch
        run: |
          BRANCH_NAME="auto-fix/sentry-${{ github.run_number }}-${{ needs.analyze-error.outputs.fix_type }}"
          git checkout -b $BRANCH_NAME
          echo "BRANCH_NAME=$BRANCH_NAME" >> $GITHUB_ENV

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“š Install dependencies
        run: npm ci

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Apply fixes based on type
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ðŸ” ESLint --fix
        run: |
          echo "ðŸ”§ Running ESLint auto-fix..."
          npm run lint -- --fix --max-warnings=9999 2>&1 || true
        continue-on-error: true

      - name: ðŸ’… Prettier format
        run: |
          echo "ðŸ’… Running Prettier..."
          npx prettier --write "src/**/*.{ts,tsx}" 2>&1 || true
        continue-on-error: true

      - name: ðŸ§ª Run tests
        id: tests
        run: |
          echo "ðŸ§ª Running tests..."
          if npm test 2>&1; then
            echo "tests_passed=true" >> $GITHUB_OUTPUT
          else
            echo "tests_passed=false" >> $GITHUB_OUTPUT
          fi
        continue-on-error: true

      - name: ðŸ“ Check for changes
        id: check-changes
        run: |
          if [[ -n $(git status --porcelain) ]]; then
            echo "has_changes=true" >> $GITHUB_OUTPUT
            echo "ðŸ“ Changes detected:"
            git status --short
          else
            echo "has_changes=false" >> $GITHUB_OUTPUT
            echo "âœ… No changes made"
          fi

      - name: ðŸ’¾ Commit fixes
        if: steps.check-changes.outputs.has_changes == 'true'
        run: |
          git config --local user.email "sentry-bot@longsang.org"
          git config --local user.name "Sentry Auto-Fix Bot ðŸ¤–"
          git add -A
          git commit -m "fix: ðŸ¤– auto-fix sentry error #${{ needs.create-fix-issue.outputs.issue_number }}

          Fix Type: ${{ needs.analyze-error.outputs.fix_type }}
          Strategy: ${{ needs.analyze-error.outputs.fix_strategy }}
          Confidence: ${{ needs.analyze-error.outputs.confidence }}
          
          Closes #${{ needs.create-fix-issue.outputs.issue_number }}"
          git push origin ${{ env.BRANCH_NAME }}

      - name: ðŸ”„ Create Pull Request
        if: steps.check-changes.outputs.has_changes == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const errorDetails = JSON.parse('${{ needs.analyze-error.outputs.error_details }}');
            const issueNumber = ${{ needs.create-fix-issue.outputs.issue_number }};
            const fixType = '${{ needs.analyze-error.outputs.fix_type }}';
            const fixStrategy = '${{ needs.analyze-error.outputs.fix_strategy }}';
            const confidence = '${{ needs.analyze-error.outputs.confidence }}';
            const testsPassed = '${{ steps.tests.outputs.tests_passed }}' === 'true';
            
            const pr = await github.rest.pulls.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ðŸ¤– [Auto-Fix] ${fixType}: ${errorDetails.title}`,
              head: process.env.BRANCH_NAME,
              base: 'main',
              body: `## ðŸ¤– Sentry Auto-Fix PR

Closes #${issueNumber}

### ðŸ“‹ Fix Details
| Property | Value |
|----------|-------|
| **Fix Type** | \`${fixType}\` |
| **Strategy** | ${fixStrategy} |
| **Confidence** | ${confidence} |
| **Tests** | ${testsPassed ? 'âœ… Passed' : 'âš ï¸ Check needed'} |

### ðŸ› Original Error
- **Type:** \`${errorDetails.title}\`
- **Message:** ${errorDetails.message}
- **File:** \`${errorDetails.file}\`
- **Line:** ${errorDetails.line}

### âœ… Checklist
- [x] ESLint auto-fix applied
- [x] Prettier formatting applied
- [${testsPassed ? 'x' : ' '}] Tests pass
- [ ] Manual review (if confidence is low)

---
*ðŸ¤– Auto-generated by Sentry Auto-Fix Pipeline*
`,
              draft: confidence === 'low'
            });
            
            // Add labels
            const labels = ['auto-fix', 'bot', 'sentry'];
            if (testsPassed) labels.push('tests-passing');
            
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.data.number,
              labels: labels
            });
            
            // Auto-approve if high confidence and tests pass
            if (confidence === 'high' && testsPassed) {
              await github.rest.pulls.createReview({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: pr.data.number,
                event: 'APPROVE',
                body: 'ðŸ¤– Auto-approved: High confidence fix with passing tests.'
              });
            }
            
            console.log(`âœ… Created PR #${pr.data.number}`);

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # JOB 4: Notify & Summary
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  notify:
    name: ðŸ“¢ Notify & Summary
    runs-on: ubuntu-latest
    needs: [analyze-error, create-fix-issue, apply-fix]
    if: always()
    
    steps:
      - name: ðŸ“Š Generate Summary
        run: |
          echo "# ðŸš€ SENTRY AUTO-FIX SUMMARY" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Pipeline Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Job | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|-----|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ” Analyze | ${{ needs.analyze-error.result == 'success' && 'âœ…' || 'âŒ' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ“ Create Issue | ${{ needs.create-fix-issue.result == 'success' && 'âœ…' || needs.create-fix-issue.result == 'skipped' && 'â­ï¸' || 'âŒ' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ”§ Apply Fix | ${{ needs.apply-fix.result == 'success' && 'âœ…' || needs.apply-fix.result == 'skipped' && 'â­ï¸' || 'âŒ' }} |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Fix Details" >> $GITHUB_STEP_SUMMARY
          echo "- **Type:** \`${{ needs.analyze-error.outputs.fix_type }}\`" >> $GITHUB_STEP_SUMMARY
          echo "- **Confidence:** ${{ needs.analyze-error.outputs.confidence }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "*ðŸš€ Powered by LongSang MEGA AUTO-FIX - Elon Musk Edition*" >> $GITHUB_STEP_SUMMARY
