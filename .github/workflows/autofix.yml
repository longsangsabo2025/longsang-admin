# ============================================================================
# ðŸ¤– AUTOFIX.CI - Automatic Code Formatting & Linting Fixes
# ============================================================================
# This workflow automatically fixes:
# - ESLint errors (auto-fixable)
# - Prettier formatting issues
# - TypeScript import organization
# - And commits the fixes automatically!
# ============================================================================

name: âœ¨ Autofix

on:
  pull_request:
  push:
    branches: [main, master, develop]

permissions:
  contents: write

jobs:
  autofix:
    name: ðŸ”§ Auto-fix Code Quality Issues
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“š Install dependencies
        run: npm ci

      # ESLint Auto-fix
      - name: ðŸ” ESLint --fix
        run: npm run lint -- --fix || true
        continue-on-error: true

      # Prettier Format
      - name: ðŸ’… Prettier format
        run: npx prettier --write "src/**/*.{ts,tsx,js,jsx,json,css,scss,md}" || true
        continue-on-error: true

      # TypeScript - Remove unused imports (if available)
      - name: ðŸ§¹ Remove unused imports
        run: |
          if npx tsc --version > /dev/null 2>&1; then
            echo "TypeScript available, checking for unused imports..."
          fi
        continue-on-error: true

      # Autofix - Commit & Push fixes automatically
      - name: âœ¨ Commit fixes
        run: |
          git config --global user.name 'Auto-Fix Bot'
          git config --global user.email 'bot@longsang.org'
          git add -A
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "style: ðŸ¤– auto-fix code quality issues"
            git push
          fi
        continue-on-error: true
