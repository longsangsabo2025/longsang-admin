{
  "name": "ðŸ“§ Advanced Email Marketing Automation",
  "nodes": [
    {
      "parameters": {
        "path": "email-marketing",
        "options": {},
        "httpMethod": "POST"
      },
      "id": "webhook-email",
      "name": "ðŸ“¥ Email Campaign Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        240,
        500
      ]
    },
    {
      "parameters": {
        "jsCode": "// Advanced Email Campaign Processor\nconst request = $input.json;\n\n// Extract campaign parameters\nconst campaignType = request.campaignType || 'newsletter';\nconst audience = request.audience || 'all_subscribers';\nconst subject = request.subject || 'Newsletter Update';\nconst template = request.template || 'default';\nconst personalization = request.personalization || true;\nconst scheduling = request.scheduling || 'immediate';\nconst abTesting = request.abTesting || false;\nconst trackingEnabled = request.trackingEnabled || true;\nconst goals = request.goals || ['open_rate', 'click_rate'];\n\n// Campaign types configuration\nconst campaignTypes = {\n    newsletter: {\n        defaultSubject: 'Weekly Newsletter',\n        frequency: 'weekly',\n        bestSendTime: '09:00',\n        expectedOpenRate: 0.25,\n        expectedClickRate: 0.03\n    },\n    promotional: {\n        defaultSubject: 'Special Offer Inside!',\n        frequency: 'monthly',\n        bestSendTime: '14:00',\n        expectedOpenRate: 0.22,\n        expectedClickRate: 0.05\n    },\n    welcome: {\n        defaultSubject: 'Welcome to Our Community!',\n        frequency: 'once',\n        bestSendTime: 'immediate',\n        expectedOpenRate: 0.35,\n        expectedClickRate: 0.08\n    }\n};\n\n// Audience segmentation\nconst audienceSegments = {\n    all_subscribers: { size: 10000, engagement: 'mixed' },\n    high_engagement: { size: 2500, engagement: 'high' },\n    medium_engagement: { size: 4000, engagement: 'medium' },\n    low_engagement: { size: 2000, engagement: 'low' }\n};\n\n// Calculate optimal send time\nconst currentConfig = campaignTypes[campaignType] || campaignTypes.newsletter;\nlet optimalSendTime = new Date();\n\nif (scheduling === 'optimal') {\n    const [hours] = currentConfig.bestSendTime.split(':');\n    optimalSendTime.setHours(parseInt(hours), 0, 0, 0);\n    if (optimalSendTime < new Date()) {\n        optimalSendTime.setDate(optimalSendTime.getDate() + 1);\n    }\n}\n\nreturn {\n    originalRequest: request,\n    campaignType: campaignType,\n    audience: audience,\n    audienceData: audienceSegments[audience] || audienceSegments.all_subscribers,\n    subject: subject,\n    template: template,\n    personalization: personalization,\n    scheduling: scheduling,\n    optimalSendTime: optimalSendTime.toISOString(),\n    abTesting: abTesting,\n    trackingEnabled: trackingEnabled,\n    goals: goals,\n    campaignConfig: currentConfig,\n    campaignId: 'email_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),\n    timestamp: new Date().toISOString()\n};"
      },
      "id": "email-processor",
      "name": "ðŸŽ¯ Email Campaign Processor",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        460,
        500
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "ab-testing",
              "leftValue": "={{ $('ðŸŽ¯ Email Campaign Processor').item.json.abTesting }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "true"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "ab-test-router",
      "name": "ðŸ§ª A/B Test Router",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        680,
        500
      ]
    },
    {
      "parameters": {
        "jsCode": "// A/B Testing Setup\nconst data = $input.json;\n\n// Create A/B test variants\nconst variantA = {\n    version: 'A',\n    subject: data.subject,\n    content: 'Dear Subscriber, We are excited to share our latest updates with you!',\n    sendTime: data.optimalSendTime,\n    audiencePercent: 50\n};\n\nconst variantB = {\n    version: 'B',\n    subject: data.subject.includes('!') ? data.subject.replace('!', ' - Limited Time') : data.subject + ' ðŸš€',\n    content: 'Hi there! We have something special for you today!',\n    sendTime: data.optimalSendTime,\n    audiencePercent: 50\n};\n\nreturn {\n    ...data,\n    abTest: {\n        enabled: true,\n        variantA: variantA,\n        variantB: variantB,\n        status: 'setup_complete',\n        testId: 'ab_test_' + Date.now()\n    }\n};"
      },
      "id": "ab-test-setup",
      "name": "ðŸ§ª A/B Test Setup",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        900,
        400
      ]
    },
    {
      "parameters": {
        "jsCode": "// Standard Email Content Generation\nconst data = $input.json;\n\nlet emailContent = '';\nlet emailSubject = data.subject;\n\nswitch (data.campaignType) {\n    case 'welcome':\n        emailContent = 'Dear Valued Customer, Welcome to our community! We are thrilled to have you on board.';\n        break;\n    case 'promotional':\n        emailContent = 'Hi there! We have an exclusive offer just for you!';\n        break;\n    case 'newsletter':\n        emailContent = 'Hello Newsletter Subscriber! Here is your weekly dose of insights and updates.';\n        break;\n    default:\n        emailContent = 'Dear Subscriber, Thank you for being part of our community.';\n}\n\nreturn {\n    ...data,\n    emailContent: {\n        subject: emailSubject,\n        content: emailContent,\n        estimatedReadTime: '2-3 minutes',\n        contentType: 'html'\n    }\n};"
      },
      "id": "content-generator",
      "name": "âœ¨ Email Content Generator",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        900,
        600
      ]
    },
    {
      "parameters": {
        "jsCode": "// Email Performance Predictor\nconst data = $input.json;\n\nconst config = data.campaignConfig;\nconst audienceData = data.audienceData;\n\n// Predict performance metrics\nconst baseOpenRate = config.expectedOpenRate;\nconst baseClickRate = config.expectedClickRate;\n\nconst predictedOpenRate = baseOpenRate * 1.1;\nconst predictedClickRate = baseClickRate * 1.1;\n\nconst predictedOpens = Math.floor(audienceData.size * predictedOpenRate);\nconst predictedClicks = Math.floor(predictedOpens * (predictedClickRate / predictedOpenRate));\nconst predictedRevenue = predictedClicks * 25;\n\nreturn {\n    ...data,\n    predictions: {\n        openRate: Math.round(predictedOpenRate * 10000) / 100,\n        clickRate: Math.round(predictedClickRate * 10000) / 100,\n        opens: predictedOpens,\n        clicks: predictedClicks,\n        estimatedRevenue: predictedRevenue,\n        deliveryRate: 98.5,\n        bounceRate: 1.5,\n        confidenceScore: Math.floor(Math.random() * 15) + 85,\n        optimizationScore: Math.floor((predictedOpenRate + predictedClickRate) * 1000)\n    }\n};"
      },
      "id": "performance-predictor",
      "name": "ðŸ“Š Performance Predictor",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1120,
        500
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "immediate-send",
              "leftValue": "={{ $('ðŸŽ¯ Email Campaign Processor').item.json.scheduling }}",
              "rightValue": "immediate",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        }
      },
      "id": "send-strategy",
      "name": "ðŸš€ Send Strategy",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1340,
        500
      ]
    },
    {
      "parameters": {
        "jsCode": "// Immediate Email Send\nconst data = $input.json;\n\nconst sendResults = {\n    campaignId: data.campaignId,\n    status: 'sent',\n    sentAt: new Date().toISOString(),\n    audienceSize: data.audienceData.size,\n    deliveredCount: Math.floor(data.audienceData.size * 0.985),\n    initialOpenCount: Math.floor(data.predictions.opens * 0.1)\n};\n\nreturn {\n    ...data,\n    sendResults: sendResults,\n    trackingEnabled: data.trackingEnabled\n};"
      },
      "id": "immediate-sender",
      "name": "ðŸ“¤ Immediate Sender",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1560,
        400
      ]
    },
    {
      "parameters": {
        "jsCode": "// Schedule Email Campaign\nconst data = $input.json;\n\nconst scheduleResults = {\n    campaignId: data.campaignId,\n    status: 'scheduled',\n    scheduledAt: new Date().toISOString(),\n    scheduledFor: data.optimalSendTime,\n    audienceSize: data.audienceData.size\n};\n\nreturn {\n    ...data,\n    scheduleResults: scheduleResults,\n    executionTime: data.optimalSendTime\n};"
      },
      "id": "campaign-scheduler",
      "name": "â° Campaign Scheduler",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1560,
        600
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n    \"status\": \"success\",\n    \"message\": \"Advanced email marketing campaign processed successfully\",\n    \"data\": {\n        \"campaignId\": \"{{ $('ðŸŽ¯ Email Campaign Processor').item.json.campaignId }}\",\n        \"campaignType\": \"{{ $('ðŸŽ¯ Email Campaign Processor').item.json.campaignType }}\",\n        \"audience\": \"{{ $('ðŸŽ¯ Email Campaign Processor').item.json.audience }}\",\n        \"audienceSize\": \"{{ $('ðŸŽ¯ Email Campaign Processor').item.json.audienceData.size }}\",\n        \"predictions\": {{ JSON.stringify($('ðŸ“Š Performance Predictor').item.json.predictions) }},\n        \"emailContent\": {{ JSON.stringify($('âœ¨ Email Content Generator').item.json.emailContent) }},\n        \"trackingEnabled\": \"{{ $('ðŸŽ¯ Email Campaign Processor').item.json.trackingEnabled }}\",\n        \"timestamp\": \"{{ $('ðŸŽ¯ Email Campaign Processor').item.json.timestamp }}\"\n    }\n}"
      },
      "id": "email-response",
      "name": "ðŸ“§ Campaign Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1780,
        500
      ]
    }
  ],
  "connections": {
    "ðŸ“¥ Email Campaign Webhook": {
      "main": [
        [
          {
            "node": "ðŸŽ¯ Email Campaign Processor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸŽ¯ Email Campaign Processor": {
      "main": [
        [
          {
            "node": "ðŸ§ª A/B Test Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ§ª A/B Test Router": {
      "main": [
        [
          {
            "node": "ðŸ§ª A/B Test Setup",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "âœ¨ Email Content Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ§ª A/B Test Setup": {
      "main": [
        [
          {
            "node": "ðŸ“Š Performance Predictor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âœ¨ Email Content Generator": {
      "main": [
        [
          {
            "node": "ðŸ“Š Performance Predictor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“Š Performance Predictor": {
      "main": [
        [
          {
            "node": "ðŸš€ Send Strategy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸš€ Send Strategy": {
      "main": [
        [
          {
            "node": "ðŸ“¤ Immediate Sender",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "â° Campaign Scheduler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“¤ Immediate Sender": {
      "main": [
        [
          {
            "node": "ðŸ“§ Campaign Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â° Campaign Scheduler": {
      "main": [
        [
          {
            "node": "ðŸ“§ Campaign Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}